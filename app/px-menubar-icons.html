<!-- Load dependencies -->
<link rel="import" href="../bower_components/polymer/polymer.html"/>
<link rel="import" href="px-menubar-icons-result.html"/>

<!-- Import style modules -->
<!-- <link rel="import" href="../css/app-styles.html"/> -->

<dom-module id="px-menubar-icons">
  <template>
    <style include="app-styles">
      .icons__search__input {
        font-size: 1.2rem;
      }
      .icons__search__toggles {
        margin-top: .75rem;
      }
      .icons__search__toggles span {
        position: relative;
        top: -0.15rem;
        padding-left: .5rem;
        padding-right: .5rem;
      }

      .icons__results {
        margin-top: .75rem;
      }
      .icons__results > px-menubar-icons-result {
        width: 33%;
        float: left;
      }
      px-menubar-icons-result {
        --iron-icon-stroke-color: currentcolor;
        --iron-icon-fill-color: transparent;
      }
      px-menubar-icons-result[size="small"] {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
      }
      px-menubar-icons-result[size="medium"] {
        --iron-icon-width: 22px;
        --iron-icon-height: 22px;
      }
      px-menubar-icons-result[size="large"] {
        --iron-icon-width: 32px;
        --iron-icon-height: 32px;
      }
    </style>
    <iron-ajax url="../data/icons.json" last-response="{{rawList}}" auto></iron-ajax>

    <!-- Intro -->
    <div class="icons__intro">
      <h3>Search for icons</h3>
    </div>

    <!-- Search -->
    <div class="icons__search">
      <input
          id="search"
          class="text-input icons__search__input"
          type="text"
          placeholder="home, dashboards, alerts"
          value="{{searchText::input}}">
      <div class="icons__search__toggles">
        <px-toggle size="small" checked="{{searchSmall}}"></px-toggle>
        <span>Small icons</span>
        <px-toggle size="small" checked="{{searchMedium}}"></px-toggle>
        <span>Medium icons</span>
        <px-toggle size="small" checked="{{searchLarge}}"></px-toggle>
        <span>Large icons</span>
      </div>
    </div>

    <!-- Results -->
    <div class="icons__results">
      <template is="dom-repeat" items="{{filteredList}}">
        <px-menubar-icons-result name="{{item.prefix}}:{{item.name}}" size$="{{item.set}}"></px-menubar-icons-result>
      </template>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'px-menubar-icons',
    properties: {
      searchText: {
        type: String,
        value: ''
      },
      rawList: {
        type: Array
      },
      filteredList: {
        type: Array,
        computed: 'getFilteredList(rawList, searchText, searchSmall, searchMedium, searchLarge)'
      },
      searchSmall: {
        type: Boolean,
        value: true
      },
      searchMedium: {
        type: Boolean,
        value: true
      },
      searchLarge: {
        type: Boolean,
        value: true
      }
    },

    get fuseOptions() {
      return {
        shouldSort: true,
        tokenize: true,
        threshold: 0.6,
        location: 0,
        distance: 100,
        maxPatternLength: 32,
        minMatchCharLength: 1,
        keys: [
          "name",
          "keywords"
        ]
      }
    },

    created() {
      this.search = new Fuse()
    },

    attached() {
      this.focusInput();
    },

    focusInput() {
      this.$.search.focus();
    },

    isEmpty(text) {
      return text.length === 0;
    },

    searchItems(items, str) {
      const fuse = new Fuse(items, this.fuseOptions);
      return fuse.search(str);
    },

    getFilteredList(rawList, searchText, searchSmall, searchMedium, searchLarge) {
      const filteredItems = rawList.filter(item => {
        if (searchSmall && item.set === 'small') return true;
        if (searchMedium && item.set === 'medium') return true;
        if (searchLarge && item.set === 'large') return true;
        return false;
      });
      if (searchText === "") {
        return filteredItems;
      }
      else {
        return this.searchItems(filteredItems, searchText);
      }
    }
  });
</script>
